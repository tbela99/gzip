!function(){"use strict";async function e(e,t="id",r=[]){return new Promise((n,a)=>{const s=indexedDB.open(e,1),o=e+"_store";let i;const c=(e,t,r=null,n=null)=>new Promise((a,s)=>{const c=t?"readonly":"readwrite";if(i.objectStoreNames.contains(o)){const t=i.transaction(o,c),l=t.objectStore(o);let u;"put"===e&&r&&void 0!==r.length?(u=t,r.forEach(e=>{l.put(e)})):(n&&l.index(n),u=l[e](r)),u.oncomplete=e=>{a(e.target.result)},u.onsuccess=e=>{a(e.target.result)},u.onerror=e=>{s(e)}}else s(new Error("Store not found"))}),l={count:async()=>{const e=i.transaction(o,"readonly").objectStore(o).count();return new Promise((function(t,r){e.onsuccess=function(e){t(e.target.result)},e.onerror=function(e){r(e)}}))},get:(e,t)=>c("get",!0,e,t),getAll:(e,t)=>c("getAll",!0,e,t),put:e=>c("put",!1,e),delete:e=>c("delete",!1,e),clear:()=>c("clear",!1),deleteDatabase:()=>new Promise((function(e,t){const r=indexedDB.deleteDatabase;r.onerror=t,r.onsuccess=e}))};s.onupgradeneeded=(()=>{i=s.result;const e=i.createObjectStore(o,{keyPath:t});let n;for(n of r)e.createIndex(n.name,n.key,n.options)}).bind(this),s.onsuccess=(()=>{i=s.result,n(l)}).bind(this),s.onerror=(e=>{a(new Error(e.originalTarget&&e.originalTarget.error||e))}).bind(this)})}const t={implement(e){const t=e.prototype,n=[].slice.call(arguments,1);let a,s,o;function i(e,t,r){return function(){const n=this,a="previous"in n,s="parent"in n,o=n.previous,i=n.parent;n.previous=t,n.parent=r;const c=e.apply(n,arguments);return a&&(n.previous=o),s&&(n.parent=i),c}}for(a=0;a<n.length;a++)for(o in n[a])switch(s=n[a][o],typeof s){case"function":t[o]=i(s,e[o],t[o]);break;case"object":t[o]=r(!0,Array.isArray(s)?[]:{},s);break;default:t[o]=s}return e},merge:r,reset:function e(n){const a=t.getAllPropertiesName(n);let s,o,i=a.length;for(;i&&i--;)s=a[i],o=Object.getOwnPropertyDescriptor(n,s),null!=n[s]&&"object"==typeof n[s]&&null!=o&&"value"in o&&o.writable&&o.configurable&&(n[s]=r(!0,Array.isArray(n[s])?[]:{},e(n[s])));return n},extendArgs:e=>function(t){if("object"==typeof t){const r=[].slice.call(arguments,1);let n;for(n in t)e.apply(this,[n,t[n]].concat(r))}else e.apply(this,arguments);return this}};function r(e){const t=[].slice.call(arguments,1);let n,a,s,o,i="boolean"==typeof e;for(!0===i&&(i=e,e=t.shift()),n=0;n<t.length;n++)if(a=t[n],null!=a)for(s in a)switch(o=a[s],typeof o){case"object":e[s]=null!=o&&i?r(i,"object"==typeof e[s]&&null!=e[s]?e[s]:Array.isArray(o)?[]:{},o):o;break;default:e[s]=o}return e}const n=t.extendArgs,a={$events:{},$pseudo:{},on:n((function(e,t,r){const n=this;if(t==u)return;let a,s;const o=e=e.toLowerCase(),i={fn:t,cb:t,name:e,original:e,parsed:[e]};if(-1!=e.indexOf(":")){const t=e.match(/([^:]+):([^(]+)(\(([^)]+)\))?/);t==u?i.name=e=e.split(":",1)[0]:(i.original=e,i.name=t[1],i.parsed=t,e=t[1],t[2]in n.$pseudo&&n.$pseudo[t[2]](i))}e in n.$events||(n.$events[e]=[]),a=n.$events[e].length;for(;a&&a--;)if(s=n.$events[e][a],s.fn==t&&s.original==o)return;Object.defineProperty(i,"sticky",{value:!!r}),n.$events[e].push(i)})),off:n((function(e,t,r){const n=this;let a,s;e=e.toLowerCase().split(":",1)[0];const o=n.$events[e];if(null!=o){for(r=!!r,s=o.length;s&&s--;)a=o[s],(null!=t||r)&&(a.fn!=t||a.sticky&&a.sticky!=r)||n.$events[e].splice(s,1);0==o.length&&delete n.$events[e]}})),resolve(e){e=e.toLowerCase();const t=this,r=arguments.length>1?[].slice.call(arguments,1):[];return Promise.all((t.$events[e]||[]).concat().map(e=>new Promise(n=>{n(e.cb.apply(t,r))})))},addPseudo(e,t){return this.$pseudo[e]=t,this}};function s(e="GET"){return Array.isArray(e)||(e=[e]),e.forEach(e=>e==u||"HEAD"==e?"GET":e.toUpperCase()),e}a.addPseudo("once",(function(e){return e.cb=function(){const t=this,r=e.fn.apply(t,arguments);return t.off(e.name,e.fn),r},this}));class o{constructor(){this.routers=Object.create(u),this.defaultRouter=Object.create(u)}getRouter(e){const t=e!=u&&e.request.method||"GET",r=this.routers[t]||[],n=r.length;let a,s=0;for(;s<n;s++)if(a=r[s],a.match(e))return a;return this.defaultRouter[t]}registerRoute(e,t="GET"){return s(t).forEach(t=>{t in this.routers||(this.routers[t]=[]),this.routers[t].push(e)}),this}unregisterRoute(e,t){return s(t).forEach(t=>{const r=this.routers[t]||[],n=r.indexOf(e);-1!=n&&r.splice(n,1)}),this}setDefaultRouter(e,t){s(t).forEach(t=>this.defaultRouter[t]=e)}getDefaultRouter(){for(let e in this.defaultRouter)return this.defaultRouter[e];return u}}t.merge(!0,o.prototype,a);class i{constructor(e,t,r=null){const n=this;n.plugins=[],n.options=Object.assign(Object.create(u),{mime:[]},r||{}),n.path=e,n.strategy=t.name,n.handler={handle:async e=>{let r,a;for(r of n.plugins)try{if(a=await r.precheck(e),a instanceof Response)return a}catch(e){console.error({error:e})}if(a=await t.handle(e),a instanceof Response)for(r of n.plugins)try{await r.postcheck(e,a)}catch(e){console.error(e.message)}return a}}}addPlugin(e){return this.plugins.includes(e)||this.plugins.push(e),this}match(e,t){return!0}}t.merge(!0,i.prototype,a);class c extends i{match(e,t){const r=e.request.url;return/^https?:/.test(r)&&this.path.test(r)||this.options.mime.includes(e.request.headers.get("Content-Type"))||t!=u&&this.options.mime.includes(t.headers.get("Content-Type"))}}class l extends i{constructor(e,t,r=null){super(e,t,r),this.url=new URL(e,self.origin)}match(e,t){const r=e.request.url,n=new URL(r);return/^https?:/.test(r)&&n.origin==this.url.origin&&0==n.pathname.indexOf(this.url.pathname)||this.options.mime.includes(e.request.headers.get("Content-Type"))||t!=u&&this.options.mime.includes(t.headers.get("Content-Type"))}}const u=null,h=Object.create(u);function f(e){var t,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return Number(r).toString(36)}function p(e){let t,r,n,a,s="",o=0;if(!e&&"object"==typeof e||"string"==typeof e)s=""+("string"==e?JSON.stringify(e):e);else{const i=function(e){let t=Object.keys(Object.getOwnPropertyDescriptors(e)),r=Object.getPrototypeOf(e);for(;r;)t=t.concat(Object.keys(Object.getOwnPropertyDescriptors(r))),r=Object.getPrototypeOf(r);return t}(e);for(;o<i.length;o++){t=i[o];try{r=e[t]}catch(e){s+="!Error["+JSON.stringify(e.message)+"],";continue}if(s+=t+":",Array.isArray(r)){for(s+="[",a=0;a<r.length;a++)s+=p(r[a])+",";","==s[s.length-1]&&(s=s.substr(0,s.length-2)),s+="]"}else if("object"==typeof r)if(r&&"string"!=typeof r)if(null!=r[Symbol.iterator])if(r.constructor&&r.constructor.name&&(s+=r.constructor.name),"function"==typeof r.forEach)s+="{",r.forEach((e,t)=>s+=t+":"+p(e)+","),","==s[s.length-1]&&(s=s.substr(0,s.length-2)),s+="}";else{for(n of(s+="[",r))s+=p(n)+",";","==s[s.length-1]&&(s=s.substr(0,s.length-2)),s+="]"}else s+="{"+p(r)+"}";else s+=""+r;else s+=JSON.stringify(r);s+=","}","==s[s.length-1]&&(s=s.substr(0,s.length-2)),Array.isArray(e)?s="["+s+"]":"object"==typeof e&&(s="{"+s+"}")}return s}function d(e,t){if(0==e)return 0;const r=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(r))).toFixed(2)+" "+(t&&t[r]?t[r]:["b","Kb","Mb","Gb","Tb","Pb"][r])}function g(e){let t,r=-1;const n=[].slice.apply(arguments).slice(1);return e.replace(/%([s%])/g,(function(e,a){if("%"==a)return a;switch(t=n[++r],a){case"s":return null==t?"":t}}))}function m(e,t=30,r=15,n="..."){return e.length>t?e.slice(0,t-r-n.length+1)+n+e.slice(e.length-r+1):e}let y;t.merge(!0,h,a),Object.defineProperties(h,{app:{value:Object.create(u)},routes:{value:new o}}),Object.defineProperties(h.app,{name:{value:"gzip",enumerable:!0},scope:{value:"{scope}",enumerable:!0},route:{value:"{ROUTE}",enumerable:!0},cacheName:{value:"{CACHE_NAME}",enumerable:!0},codeName:{value:"Joomla Website Optimizer Plugin",enumerable:!0},build:{value:"{VERSION}",enumerable:!0},buildid:{value:"build-id",enumerable:!0},builddate:{value:"build-date",enumerable:!0},urls:{value:"{CDN_HOSTS}",enumerable:!0},backgroundSync:{value:"{BACKGROUND_SYNC}",enumerable:!0},offline:{value:"{pwa_offline_page}"},network:{value:"{pwa_cache_settings}"},customNetwork:{value:"{pwa_custom_cache_settings}"},precache:{value:"{preloaded_urls}".map(e=>new URL(e,self.origin).href),enumerable:!0},homepage:{value:"https://github.com/tbela99/gzip",enumerable:!0}}),caches.open(h.app.cacheName).then(e=>y=e);class w{constructor(e){this.setOptions(e)}getRouteTag(e){const t=h.app.route;let r;for(r of h.app.urls)if(new RegExp("^https?://"+r+h.app.scope+t+"/").test(e))return t;return u}async setOptions(t){const r=new Date,n=+r;this.maxAge=0,this.limit=+t.limit||0,this.maxFileSize=+t.maxFileSize||0;const a=t.maxAge.match(/([+-]?\d+)(.*)$/);if(null!=a)switch(a[2]){case"months":case"minutes":case"hours":let e=(s=a[2])[0].toUpperCase()+s.slice(1);"Months"==e&&(e="Month"),r["set"+e](+a[1]+r["get"+e]()),this.maxAge=r-n}var s;this.db=await e(t.cacheName!=u?t.cacheName:"gzip_sw_worker_expiration_cache_private","url",[{name:"url",key:"url"},{name:"version",key:"version"},{name:"route",key:"route"}])}async precheck(e){try{if(this.db==u||0==this.maxAge)return!0;const t=f(p(e.request)),r=await this.db.get(e.request.url,"url");return r!=u&&(r.version!=t||r.timestamp<Date.now())?(await caches.delete(e.request),!0):await y.match(e.request)}catch(e){console.error("ðŸ˜­",e)}return!0}async postcheck(e,t){if(this.db==u)return!0;if(this.maxFileSize>0&&t.body!=u){const e=await t.clone().blob();if(e.size>this.maxFileSize)throw g("cache limit exceeded. Deleting item [%s]",m(t.url)),await this.db.delete(t.url),await y.delete(t),new Error(g("[%s][cache failed] cache size limit exceeded %s of %s",m(t.url,42),d(e.size),d(this.maxFileSize)))}try{const t=e.request.url,r=await this.db.get(t,"url"),n=f(p(e.request));return r==u||r.version!=n||r.timestamp<Date.now()?await this.db.put({url:t,timestamp:Date.now()+this.maxAge,route:this.getRouteTag(t),version:n}):t}catch(e){console.error("ðŸ˜­",e)}return!0}}const b=(e,t)=>t instanceof Response&&("cors"==t.type||new URL(e.url,self.origin).origin==self.origin)&&"GET"==e.method&&t.ok&&["default","cors","basic","navigate"].includes(t.type)&&!t.bodyUsed,v=new Map,k={add:(e,t,r)=>v.set(e,{key:e,name:r==u?e:r,handle:async e=>await t(e)}),keys:()=>v.keys(),values:()=>v.values(),entries:()=>v.entries(),get:e=>v.get(e),has:e=>v.has(e),delete:e=>v.delete(e),isCacheableRequest:b};k[Symbol.iterator]=()=>v[Symbol.iterator](),Object.defineProperty(k,"size",{get:()=>v.size});const _=h.app.cacheName,R=h.app.cacheName,x=h.app.cacheName,O=h.app.cacheName;k.add("cf",(async function(e){let t=await caches.match(e.request,{cacheName:_});if(null!=t)return t;if(t=await fetch(e.request),k.isCacheableRequest(e.request,t)){const r=t.clone();caches.open(_).then(t=>t.put(e.request,r))}return t}),"Cache fallback to Network"),k.add("cn",(async function(e){const t=await caches.match(e.request,{cacheName:R}),r=fetch(e.request).then(t=>{if(k.isCacheableRequest(e.request,t)){const r=t.clone();caches.open(R).then(t=>t.put(e.request,r))}return t}).catch(()=>{});return t||r}),"Cache and Network Update"),k.add("co",(async function(e){return await caches.match(e.request,{cacheName:x})}),"Cache Only"),k.add("nf",(async function(e){try{const t=await fetch(e.request);if(null==t)throw new Error("Network error");if(k.isCacheableRequest(e.request,t)){const r=t.clone();caches.open(O).then(t=>t.put(e.request,r))}return t}catch(e){}return caches.match(e.request,{cacheName:O})}),"Network fallback to Cache"),k.add("no",(async function(e){return fetch(e.request)}),"Network Only"),self.addEventListener("activate",e=>{e.waitUntil((async()=>{try{await h.resolve("activate",e)}catch(e){console.error("ðŸ˜­",e)}return self.clients.claim()})())}),self.addEventListener("fetch",e=>{e.respondWith(!e.url||"only-if-cached"===e.request.cache&&"same-origin"!==e.request.mode?fetch(e.request):async function(){let t;const r=h.routes.getRouter(e);if(r!=u)try{if(t=await r.handler.handle(e),t instanceof Response)return t;for(t of await h.routes.resolve("fail",e,t))if(t instanceof Response)return t}catch(e){console.error("ðŸ˜­",e)}return fetch(e.request)}())}),self.addEventListener("install",e=>{e.waitUntil((async()=>{try{await h.resolve("install",e)}catch(e){console.error("ðŸ˜­",e)}return self.skipWaiting()})())});const q=["method","referrer","referrerPolicy","mode","credentials","cache","redirect","integrity","keepalive"];class A{async push(e){const t=await this.cloneRequestData(e),r=await this.getDB();return await r.put({id:f(e.url+q.map(async e=>{let r=t[e];return r==u?"":"headers"==e?r instanceof Headers?[...r.values()].filter(e=>e!=u).join(""):Object.values(r).map(r=>t[e][r]!=u?t[e][r]:"").join(""):"body"==e?await r.text():r}).join("")),lastRetry:Date.now()+864e5,url:e.url,request:t}),this}async cloneRequestData(e){const t={headers:{}};"GET"!==e.method&&(t.body=await e.clone().arrayBuffer());for(const[r,n]of e.headers.entries())t.headers[r]=n;for(const r of q)void 0!==e[r]&&(t[r]=e[r]);return"navigate"===t.mode&&(t.mode="same-origin"),t}async getDB(){return this.db==u&&(this.db=await e("gzip_sw_worker_sync_requests","id")),this.db}async replay(e){if("{SYNC_API_TAG}"!=e)return;const t=await this.getDB(),r=await t.getAll();r.length;const n=await caches.open("{CACHE_NAME}");for(const e of r){let r=!1;try{e.request.method,e.url;const t=new Request(e.url,e.request);let a=await n.match(t);r=a!=u,r||(a=await fetch(t.clone()),r=a!=u&&a.ok,r&&b(t,a)&&await n.put(t,a))}catch(e){}(r||e.lastRetry<=Date.now())&&await t.delete(e.id)}}}if(h.app.backgroundSync.enabled){const t=new A;h.on({async install(){for(const t of["gzip_sw_worker_sync_requests","gzip_sw_worker_sync_tasks"]){const r=await e(t,"id");null!=r&&await r.clear()}}}),h.routes.on({fail(e,r){const n=h.app.backgroundSync;if(0==n.length||-1!=n.method.indexOf(e.method)){const r=e.url.replace(self.origin,"");if(0==n.pattern.length||n.pattern.some(e=>0==r.indexOf(e)))return t.push(e)}}}),self.addEventListener("sync",(function(e){e.tag,e.waitUntil(t.replay(e.tag).catch(e=>console.error({error:e})))}))}h.app.network.limit>0&&self.addEventListener("sync",async t=>{const r=await async function(){let t=await caches.open("{CACHE_NAME}");const r="{preloaded_urls}".map(e=>new URL(e,self.origin).href),n="{pwa_cache_max_file_count}",a=await e("gzip_sw_worker_expiration_cache_private","url",[{name:"url",key:"url"},{name:"version",key:"version"},{name:"route",key:"route"}]);return async function(){let e=await a.count();if(e>n){g("cleaning up [%s] items present. [%s] items allowed",e,n);for(let s of await a.getAll())if(r.includes(s.url))g("skipped preloaded resource [%s]",s.url);else if(g("removing [%s]",s.url),await t.delete(s.url),await a.delete(s.url),--e<=n)break;g("cleaned up [%s] items present. [%s] items allowed",e,n)}}}();t.waitUntil(r())}),h.app.offline.enabled&&h.routes.on("fail",async e=>{if("navigate"==e.request.mode&&h.app.offline.methods.includes(e.request.method)){if("response"==h.app.offline.type)return new Response(h.app.offline.body,{headers:new Headers({"Content-Type":'text/html; charset="{offline_charset}"'})});if(""!=h.app.offline.url)return caches.match(h.app.offline.url)}});const E=h.routes,N=h.app.scope,j=h.app.network,S=j.caching;let C,P,z,D,T,U,$;({limit:T,maxAge:z,cacheName:U,strategy:$,maxFileSize:D}=j);const L={limit:T,maxAge:z,strategy:$,maxFileSize:D};for(C of"{exclude_urls}")E.registerRoute(new c(new RegExp(C),k.get("no")));for(C of j.settings)P=new c(new RegExp("("+C.ext.join(")|(")+")","i"),k.get(C.strategy),C),S&&(({limit:T,maxAge:z,maxFileSize:D}=C),P.addPlugin(new w({limit:T,maxAge:z,maxFileSize:D}))),E.registerRoute(P);for(C of k)P=new l(N+"{ROUTE}/media/z/"+C[0]+"/",C[1]),S&&P.addPlugin(new w(L)),E.registerRoute(P),h.app.customNetwork.forEach(e=>{let t=N+"{ROUTE}/"+C[0]+"/"+e.prefix+"/";delete e.prefix;let r=new l(t,e);r.addPlugin(new w(e)),E.registerRoute(r)});P=new l(N,k.get(j.strategy)),S&&P.addPlugin(new w(L)),E.setDefaultRouter(P),U=h.app.cacheName,h.on({error(e,t){console.error({error:e,event:t})},async install(){await caches.open(U).then(async e=>await e.addAll(h.app.precache))},async activate(){const t=await e("gzip_sw_worker_config_cache_private","name"),r=await t.get("gzip");if(r!=u&&"{ROUTE}"!=r.route){let t,r;for(t of"{STORES}")r=await e(t,"url",[{name:"url",key:"url"},{name:"version",key:"version"},{name:"route",key:"route"}]),r!=u&&r.clear()}await t.put(h.app);const n=await caches.keys(),a=U.split(/_/,2),s=2==a.length&&a[0]+"_";0!=s&&await Promise.all(n.map(e=>0==e.indexOf(s)&&e!=U&&caches.delete(e)))}})}();